<section>
  <div ng-controller=CalendarviewsListController id="app">
    <script>
      var timer = setInterval(checkDataReady, 100);

      function checkDataReady() {
        var data = angular.element(document.getElementById('app')).scope().data;
        //var userData = angular.element(document.getElementById('app')).scope().userData;
        if (data) {
          clearInterval(timer);
          $(document).ready(function() {
            //console.log(data);
            //console.log(userData);
            $('#calendar').fullCalendar({
              header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,agendaWeek,agendaDay'
              },
              defaultDate: Date.now(),
              navLinks: true, // can click day/week titles to navigate views
              selectable: false,
              selectHelper: false,
              timezone: 'local',
              /*select: function(start, end) {
                var title = prompt('Event Title:');
                var start = prompt('Event start Time:');
                var end = prompt('Event End Time:');
                var eventData;
                if (title) {
                  eventData = {
                    title: title,
                    start: start,
                    end: end
                  };
                  $('#calendar').fullCalendar('renderEvent', eventData, true); // stick? = true
                }
                $('#calendar').fullCalendar('unselect');
              },*/
              editable: false,
              eventLimit: true, // allow "more" link when too many events
              events: data,
            });
          });
        }
      }
      //setTimeout(checkDataReady,1000);
    </script>
    <style>
      body {
        padding: 0;
        font-family: "Lucida Grande", Helvetica, Arial, Verdana, sans-serif;
        font-size: 14px;
      }

      #calendar {
        max-width: 900px;
        margin: 0 auto;
      }
    </style>

    </br>

    <div class="col-md-9">
      <div id='calendar'></div>
    </div>
    <div class="col-md-3" style="text-align:center;" ng-if="vm.calendarviews.length">
      <h4>List of Future Events</h4>
      <div class='row'>
        <input type="text" ng-model="title_input.username" placeholder="Search Keywords..." class="form-control">
      </div>
      <div class='row'>
        <table class="table">
          <tr>
            <th style="text-align:center;">CLASS</th>
            <th style="text-align:center;">START TIME</th>
            <th style="text-align:center;">END TIME</th>
          </tr>
          <tr ng-repeat="calendar in vm.calendarviews | orderBy:'start' | filter:title_input.username |filter:onlyAfter" ng-if="(calendar.trainer==vm.authentication.user.username || vm.authentication.user.roles=='admin')" ui-sref="calendarviews.view({ calendarviewId: calendar._id })">
            <td>{{calendar.title}}</td>
            <td>{{calendar.start}}</td>
            <td>{{calendar.end}}</td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</section>
